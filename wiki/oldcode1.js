// –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
var TelegramBot = require('telegraf'); // telegraf library
var Config      = require('./config'); // get config

// –¢–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–∑–Ω—É—Ç—Ä–∏
/*
  telegraf.js:
  module.exports(id) = {
    identity: id,
    hears(){
      ...
      return ...
    },
    on(){
      ...
      return ...
    },
    ...
  }
*/
// –í –Ω–µ–π –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–∏

// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–æ—Ç–∞ —Ç–µ–ª–µ–≥—Ä–∞–º–º
var app         = new TelegramBot(Config.bot_token);

// –ü—Ä–∏–º–µ—Ä—ã –æ–ø–∏—Å–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
/* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: ['book':{'name':'–ö–∞–ø–∏—Ç–∞–Ω—Å–∫–∞—è –¥–æ—á–∫–∞', 'author':'–ü—É—à–∫–∏–Ω –ê. –°.', 'amount':5}, 'student':{'name':'', 'till':''}]
 * –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: {'–ü–Ω':[{'time':'10:00', 'subject':'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'}, {'time':'10:45', 'subject':'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'}, ...]}
 * –°—Ç–æ–ª–æ–≤–∞—è: –º–µ–Ω—é, –∫–æ–ª-–≤–æ —É—á–µ–Ω–∏–∫–æ–≤
 */

//–û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
var a = 1;
var b = 2;

// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
app.hears('–ü—Ä–∏–≤–µ—Ç', (ctx) => ctx.reply('–ü—Ä–∏–≤–µ—Ç :)'));
app.hears('1+2?', (ctx) => ctx.reply(s(a, b)));

// –≠—Ç–æ –∫—Ä–∏–≤–æ–π callback —Ñ—É–Ω–∫—Ü–∏–∏
/*var s = function(a, b, function() {
  ctx = a+b;
  console.log(ctx);
  return ctx;
}){
  return null;
};*/

// –ü–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º...
app.hears('–ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫?', (ctx) => {
   ctx.reply('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:');
   //ctx.reply(schedule.monday); //–æ–π, –Ω–µ —Å–æ–≤—Å–µ–º —Ç–æ, —á—Ç–æ —Ö–æ—Ç–µ–ª–∏...
});

// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ —Å—Ç–∏–∫–µ—Ä—ã –∏ —Ñ–æ—Ç–æ
app.on('sticker', (ctx) => ctx.reply('üëç'));
app.on('photo', (ctx) => ctx.reply('üëç like :)'));

// Log —Å–æ–æ–±—â–µ–Ω–∏—è
app.on('text', (ctx) => {
  console.log(ctx);
  //console.log('–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (update_id): ' + ctx.update.update_id);
  //console.log('–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + ctx.update.message.text);
  //ctx.reply('–ü—Ä–∏–≤–µ—Ç –º–∏—Ä. –ê–ª–∏—Å–∞ –º–æ–ª–æ–¥–µ—Ü');
  ctx.reply(ctx.message);
});

// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
app.command('start', (ctx) => {
  console.log('start', ctx.from);
  ctx.reply('–î–∞, –¥–∞–≤–∞–π –Ω–∞—á–Ω—ë–º...');
  ctx.reply('–ú–µ–Ω—è –∑–æ–≤—É—Ç c3po');
});

app.command('help', (ctx) => {
  console.log('help', ctx.from);
  ctx.reply('–ü–æ–º–æ–≥–∏ —Å–µ–±–µ —Å–∞–º, –±—É–¥—å —É–º–Ω–∏—á–∫–æ–π!');
});

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞
app.startPolling();
