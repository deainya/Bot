//'use strict'; //ECMAScript standard

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
const TelegramBot = require('telegraf'); // telegraf library
var Config        = require('./config'); // get config

// –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–æ—Ç–∞ —Ç–µ–ª–µ–≥—Ä–∞–º–º
var app           = new TelegramBot(Config.bot_token);

/*app.getMe((res) => {
  console.log(res);
});
 */

/* –ù–∞—à –±–æ—Ç –±—É–¥–µ—Ç —É–º–µ—Ç—å —Å–∫–∞–∑–∞—Ç—å –µ—Å—Ç—å –ª–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∫–Ω–∏–≥–∞ –≤ —à–∫–æ–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
 * –ï—â—ë –æ–Ω —Å–º–æ–∂–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–æ–≤ –Ω–∞ –¥–µ–Ω—å
 * –ò —á–µ–º –≤–∫—É—Å–Ω—ã–º —Å–µ–≥–æ–¥–Ω—è —É–≥–æ—â–∞—é—Ç –≤ —Å—Ç–æ–ª–æ–≤–æ–π (–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ...)
 */

// –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
var a = 1;
var b = 2;

/*
1. –ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ [–¥–µ–Ω—å/—Å–µ–≥–æ–¥–Ω—è]?
1a. –ü–æ–∫–∞–∂–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ [–¥–µ–Ω—å/—Å–µ–≥–æ–¥–Ω—è].
1b. –ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã/—É—Ä–æ–∫–∏ [—Å–µ–≥–æ–¥–Ω—è]?
1c. –ö–∞–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã/—É—Ä–æ–∫–∏ –≤ [–¥–µ–Ω—å]?

2. –í–æ —Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è/–∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —É—Ä–æ–∫–∏ [—Å–µ–≥–æ–¥–Ω—è]?
2a. –í–æ —Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è/–∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è —É—Ä–æ–∫–∏ –≤ [–¥–µ–Ω—å]?

3. –°–∫–æ–ª—å–∫–æ/–∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤/—É—Ä–æ–∫–æ–≤ [—Å–µ–≥–æ–¥–Ω—è]?
3a. –°–∫–æ–ª—å–∫–æ/–∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤/—É—Ä–æ–∫–æ–≤ –≤ [–¥–µ–Ω—å]?

4. –ü–æ–∫–∞–∂–∏ (–≤—Å—ë) —Ä–∞—Å–ø–∏—Å–∞–Ω–µ (–Ω–∞ –Ω–µ–¥–µ–ª—é).
4a. –ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é?

5. –ï—Å—Ç—å –ª–∏ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] [—Å–µ–≥–æ–¥–Ω—è]?
5a. –ï—Å—Ç—å –ª–∏ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] –≤ [–¥–µ–Ω—å]?

6. –í–æ —Å–∫–æ–ª—å–∫–æ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] [—Å–µ–≥–¥–æ–Ω—è]?
6a. –í–æ —Å–∫–æ–ª—å–∫–æ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] –≤ [–¥–µ–Ω—å]?

7. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏...
 */

var schedule = { monday :   [ {time:' 8:00', subject:'–ú—É–∑—ã–∫–∞'},
                              {time:' 8:45', subject:'–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞'},
                              {time:' 9:40', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
                              {time:'10:35', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
                              {time:'11:30', subject:'–û–±—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ'} ],
                 tuesday:   [ {time:' 8:00', subject:'–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è'},
                              {time:' 8:45', subject:'–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è'},
                              {time:' 9:40', subject:'–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫'},
                              {time:'10:35', subject:'–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫'},
                              {time:'11:30', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
                              {time:'12:20', subject:'–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞'},
                              {time:'13:10', subject:'–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞'} ],
                 wednesday: [ {time:' 8:00', subject:'–î–∏–∑.–û–ü–ú'},
                              {time:' 8:45', subject:'–î–∏–∑.–û–ü–ú'},
                              {time:' 9:40', subject:'–ò—Å—Ç. –∏—Å–∫.'},
                              {time:'10:35', subject:'–†–∏—Ç–º–∏–∫–∞'},
                              {time:'11:30', subject:'–ò—Å—Ç–æ—Ä–∏—è'},
                              {time:'12:20', subject:'–ò—Å—Ç–æ—Ä–∏—è'},
                              {time:'13:10', subject:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'} ],
                 thursday:  [ {time:' 8:00', subject:'–û–î–ù–ö–ù–†'},
                              {time:' 8:45', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
                              {time:' 9:35', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
                              {time:'10:25', subject:'–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞'},
                              {time:'11:15', subject:'–ì–µ–æ–≥—Ä–∞—Ñ–∏—è'},
                              {time:'12:00', subject:'–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫'},
                              {time:'12:45', subject:'–ë–∏–æ–ª–æ–≥–∏—è'} ],
                 friday:    [ {time:' 8:00', subject:'–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞'},
                              {time:' 8:45', subject:'–¶–≤–µ—Ç–æ–≤–µ–¥–µ–Ω–∏–µ'},
                              {time:' 9:40', subject:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'},
                              {time:'10:35', subject:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'},
                              {time:'11:30', subject:'–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞'},
                              {time:'12:20', subject:'–í–î –ü—Ä–∞–≤.'} ],
                 saturday:  [ {time:' 8:00', subject:'–í–î –ú–ü–ò'},
                              {time:' 8:45', subject:'–í–î –ú–ü–ò'},
                              {time:' 9:40', subject:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'},
                              {time:'10:35', subject:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'},
                              {time:'11:30', subject:'–†–∏—Ç–º–∏–∫–∞'} ],
                 sunday:    []
               };

// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
app.command('start', (ctx) => {
  console.log('start', ctx.from);
  ctx.reply('–î–∞, –¥–∞–≤–∞–π –Ω–∞—á–Ω—ë–º...');
  ctx.reply('–ú–µ–Ω—è –∑–æ–≤—É—Ç c3po');
});
app.command('help', (ctx) => {
  console.log('help', ctx.from);
  ctx.reply('–ü–æ–º–æ–≥–∏ —Å–µ–±–µ —Å–∞–º, –±—É–¥—å —É–º–Ω–∏—á–∫–æ–π!');
});

// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
/*
telegraf.js:
module.exports(id) = {
  identity: id,
  hears(){
    ...
    return ...
  },
  on(){
    ...
    return ...
  },
  ...
}
 */
app.hears('–ü—Ä–∏–≤–µ—Ç', (ctx) => ctx.reply('–ü—Ä–∏–≤–µ—Ç :)'));

// –≠—Ç–æ –∫—Ä–∏–≤–æ–π callback —Ñ—É–Ω–∫—Ü–∏–∏
/*var s = function(a, b, function() {
  ctx = a+b;
  console.log(ctx);
  return ctx;
}){
  return null;
};*/

app.hears('1+2?', (ctx) => ctx.reply(s(a, b)));

// –ø—Ä–æ–±–æ–≤–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º...
//app.hears('–ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫?', (ctx) => {
  // ctx.reply('–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:');
  // ctx.reply(schedule.monday); //–æ–π, –Ω–µ —Å–æ–≤—Å–µ–º —Ç–æ, —á—Ç–æ —Ö–æ—Ç–µ–ª–∏...
//});

// Log —Å–æ–æ–±—â–µ–Ω–∏—è
//app.on('message', (ctx) => {
//  console.log(ctx);
//  ctx.reply(ctx.message);
//});
// –ó–∞–¥–∞—ë–º —Ä–µ–∞–∫—Ü–∏—é –±–æ—Ç–∞ –Ω–∞ —Å—Ç–∏–∫–µ—Ä—ã –∏ —Ñ–æ—Ç–æ
//app.on('sticker', (ctx) => ctx.reply('üëç'));
//app.on('photo', (ctx) => ctx.reply('üëç like :)'));

// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
// –ê–ª–∏—Å–∏–Ω—ã –ø—Ä–æ–±—ã –ø–µ—Ä–∞ - —Ç.–µ. —Ä–µ–∞–∫—Ü–∏—è –±–æ—Ç–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
//  var schedule = { monday :   [ {time:' 8:00', subject:'–ú—É–∑—ã–∫–∞'},
//                                {time:' 8:45', subject:'–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞'},
//                                {time:' 9:40', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
//                                {time:'10:35', subject:'–†—É—Å—Å–∫–∏–π —è–∑—ã–∫'},
//                                {time:'11:30', subject:'–û–±—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ'} ],
/*
4. –ü–æ–∫–∞–∂–∏ (–≤—Å—ë) —Ä–∞—Å–ø–∏—Å–∞–Ω–µ (–Ω–∞ –Ω–µ–¥–µ–ª—é).
4a. –ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é?
5. –ï—Å—Ç—å –ª–∏ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] [—Å–µ–≥–æ–¥–Ω—è]?
5a. –ï—Å—Ç—å –ª–∏ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] –≤ [–¥–µ–Ω—å]?
6. –í–æ —Å–∫–æ–ª—å–∫–æ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] [—Å–µ–≥–¥–æ–Ω—è]?
6a. –í–æ —Å–∫–æ–ª—å–∫–æ (—É –º–µ–Ω—è) [–ø—Ä–µ–¥–º–µ—Ç] –≤ [–¥–µ–Ω—å]?
*/
app.on('text', function(ctx) {
  var mon = /(–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫|–ø–Ω.)/;
  var txt = ctx.message.text.toLowerCase(); // –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã —Å–≤–æ–π—Å—Ç–≤–∞ "text" –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ "ctx" –¥–µ–ª–∞–µ—Ç –º–∞–ª–µ–Ω—Ç–∫–∏–º–∏
  console.log(txt); // –í—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å —Å–≤–æ–π—Å—Ç–≤–æ "text" (—É–∂–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –±—É–∫–≤—ã) –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ "ctx"

  if (mon.test(txt))
  {
    // –ù–∏–∂–µ –≤—ã–≤–æ–¥–∏–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç "ctx" –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ctx.reply( '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:' + '\n' +
                JSON.stringify(schedule.monday);//[0].time+' '+schedule.monday[0].subject);
  } else {
    ctx.reply( '–ù–µ –ø–æ–Ω—è–ª –≤–∞—Å, –º–∞—Å—Ç–µ—Ä –õ—é–∫' ); //–°–∫–∞–π–≤–æ–∫–µ—Ä
  }

});
// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
//  console.log(ctx);//  console.log('–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (update_id): ' + ctx.update.update_id);//  console.log('–¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + ctx.update.message.text);//  ctx.reply('–ü—Ä–∏–≤–µ—Ç –º–∏—Ä. –ê–ª–∏—Å–∞ –º–æ–ª–æ–¥–µ—Ü');

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞
app.startPolling();

// –ù–∏–∂–µ –ø—Ä–∏–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤
/* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: ['book':{'name':'–ö–∞–ø–∏—Ç–∞–Ω—Å–∫–∞—è –¥–æ—á–∫–∞', 'author':'–ü—É—à–∫–∏–Ω –ê. –°.', 'amount':5}, 'student':{'name':'', 'till':''}]
 * –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: {'–ü–Ω':[{'time':'10:00', 'subject':'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'}, {'time':'10:45', 'subject':'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞'}, ...]}
 * –°—Ç–æ–ª–æ–≤–∞—è: –º–µ–Ω—é, –∫–æ–ª-–≤–æ —É—á–µ–Ω–∏–∫–æ–≤
 * –ü–µ—Ä–µ–≤–æ–¥?
 */
